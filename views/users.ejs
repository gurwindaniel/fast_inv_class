<%- include('./partials/header') %>

<%
  function fieldError(field) {
    if (!errors) return null;
    return errors.find(e => e.instancePath === '/' + field);
  }
%>

<h3>Create New User</h3>

<% if (success) { %>
  <div class="alert alert-success"><%= success %></div>
<% } %>

<% if (error) { %>
  <div class="alert alert-danger"><%= error %></div>
<% } %>

<form action="/users/create" method="POST" class="mt-3">

  <!-- Username -->
  <div class="mb-3">
    <label class="form-label">User Name</label>
    <input
      type="text"
      name="user_name"
      value="<%= formData.user_name || '' %>"
      class="form-control <%= fieldError('user_name') ? 'is-invalid' : '' %>">

    <% if (fieldError('user_name')) { %>
      <div class="invalid-feedback">
        <%= fieldError('user_name').message %>
      </div>
    <% } %>
  </div>

  <!-- Password -->
  <div class="mb-3">
    <label class="form-label">Password</label>
    <input
      type="password"
      name="passwords"
      class="form-control <%= fieldError('passwords') ? 'is-invalid' : '' %>">

    <% if (fieldError('passwords')) { %>
      <div class="invalid-feedback">
        <%= fieldError('passwords').message %>
      </div>
    <% } %>
  </div>

  <!-- Role -->
  <div class="mb-3">
    <label class="form-label">Role</label>
    <select
      name="role_id"
      class="form-select <%= fieldError('role_id') ? 'is-invalid' : '' %>">

      <option value="">-- Select Role --</option>

      <% roles.forEach(r => { %>
        <option
          value="<%= r.role_id %>"
          <%= formData.role_id == r.role_id ? 'selected' : '' %>>
          <%= r.role_name %>
        </option>
      <% }) %>
    </select>

    <% if (fieldError('role_id')) { %>
      <div class="invalid-feedback">
        <%= fieldError('role_id').message %>
      </div>
    <% } %>
  </div>

  <button type="submit" class="btn btn-danger">Create User</button>

</form>

<%- include('./partials/footer') %>
